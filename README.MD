<div id="header" align="center">
  <img src="https://media.giphy.com/media/M9gbBd9nbDrOTu1Mqx/giphy.gif" width="100"/>
</div>

## üë§ –ê–≤—Ç–æ—Ä

Rinat Sarmuldin. email----> ura07srr@gmail.com
Task 5. 2025 –≥–æ–¥

##  Music Store ‚Äî Task 5. Symfony 6.4 + Docker + Node Audio Server

### –£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç, –≥–µ–Ω–µ—Ä–∏—Ä—É—é—â–∏–π –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤.
–í—ã–ø–æ–ª–Ω–µ–Ω –Ω–∞ symfony 6.4, –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ Docker –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ª—é–±–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π.

üìå –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
–ú–æ–¥—É–ª—å.–û–ø–∏—Å–∞–Ω–∏–µ
üéº –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Å–µ–Ω	–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥: —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤, –∂–∞–Ω—Ä—ã, –æ–±–ª–æ–∂–∫–∏, –æ–±–∑–æ—Ä—ã
üñº –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–±–ª–æ–∂–µ–∫	PNG-–∫–∞—Ä—Ç–∏–Ω–∫–∏ —á–µ—Ä–µ–∑ PHP-GD, –Ω–∞ –æ—Å–Ω–æ–≤–µ seed + index
üîä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ	Node.js —Å–µ—Ä–≤–µ—Ä, —Å–æ–∑–¥–∞—é—â–∏–π MP3-—à—É–º (–≤–∞–ª–∏–¥–Ω—ã–π –ø–æ—Ç–æ–∫)
üåê Web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å	–°–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤ + –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
üîó API	/api/songs/list, /api/songs/details/{id}, /api/songs/cover/{id}
üê≥ Docker-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è	PHP-FPM, PostgreSQL, NGINX, Node Audio Server
üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫
### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:Docker 24+, Docker Compose 2+, —Å–≤–æ–±–æ–¥–Ω—ã–µ –ø–æ—Ä—Ç—ã--> 8080/4000/5432.
1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ.
* cd task5-music-store
2. –°—Ç–∞—Ä—Ç –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.
   * docker compose up -d --build
3. 
3. –û—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç.
   *  http://localhost:8080

#### –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
#### –ü—Ä–æ–µ–∫—Ç —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∫—Ä–∏–ø—Ç rebuild.sh.
#### –ó–∞–ø—É—Å–∫:
* chmod +x rebuild.sh
* ./rebuild.sh


#### –ß—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∫—Ä–∏–ø—Ç ./rebuild.sh:
* –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
* –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã
* –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç —Å –Ω—É–ª—è
* –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–≤–µ–∂—É—é –≤–µ—Ä—Å–∏—é

üß™ –ü–æ–ª–µ–∑–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API:
curl http://localhost:8080/api/songs/details/5

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞—É–¥–∏–æ-—Å–µ—Ä–≤–µ—Ä:
curl -I http://localhost:4000/audio?seed=1&index=5

* –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à Symfony:
* docker compose exec php php bin/console cache:clear


üß† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
#### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç	–í–µ—Ä—Å–∏—è
Symfony	6.4
PHP	8.2 FPM (Alpine)
Node.js	22 (audio server)
–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö	PostgreSQL 16
Web-—Å–µ—Ä–≤–µ—Ä	NGINX 1.27
PHP-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è	gd, pdo_pgsql, mbstring, –¥—Ä.
üéß –≠–Ω–¥–∏–Ω–≥–∏ API (–∫—Ä–∞—Ç–∫–æ)
#### Endpoint	
* /api/songs/list	GET	–°–ø–∏—Å–æ–∫ –ø–µ—Å–µ–Ω
* /api/songs/details/{index}	GET	–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
* /api/songs/cover/{index}	GET	PNG-–æ–±–ª–æ–∂–∫–∞
* /song/{index}	GET	–î–µ—Ç–∞–ª—å–Ω–∞—è –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Å–Ω–∏

#### –í—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω—ã: –ø—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º (seed, locale, index) —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—Å–µ–≥–¥–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π.

üì¶ Deployment (—Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ)

#### –ü—Ä–æ–µ–∫—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ –Ω–∞:
* Ubuntu / Debian / Arch / Fedora
* macOS Intel / M-series
* Windows (Docker Desktop)
* VPS (Hetzner / DigitalOcean / AWS / Render)

#### –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Docker.

## ‚úÖ –ò–ù–°–¢–†–£–ö–¶–ò–Ø: –ö–∞–∫ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å Task5-Music-Store –Ω–∞ VPS

* –ù–∏–∂–µ ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º, –Ω–∞ –æ–±–ª–∞—á–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ.
#### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
* apt update
* apt upgrade -y
* apt install -y curl git nano unzip
#### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker
* curl -fsSL https://get.docker.com | sh
*  systemctl enable docker
* systemctl start docker
* docker --version

#### 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker Compose Plugin
* apt install -y docker-compose-plugin
*  docker compose version
#### 4. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞
* mkdir -p /var/www/task5-music-store
* cd /var/www/task5-music-store
#### 5. –°–∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç (–∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å)
* –ï—Å–ª–∏ Git –¥–æ—Å—Ç—É–ø–µ–Ω:

git clone https://github.com/USER/task5-music-store.git .


–ï—Å–ª–∏ –∞—Ä—Ö–∏–≤:

unzip task5-music-store.zip -d 
#### 6. –í—ã—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞
* –û—á–µ–Ω—å –≤–∞–∂–Ω–æ –¥–ª—è Nginx –∏ PHP-FPM Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

* chown -R root:www-data /var/www/task5-music-store
* chmod -R 755 /var/www/task5-music-store
####  7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env
* –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª:

nano .env


–ù—É–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

APP_ENV=prod
AUDIO_SERVER_URL=http://SERVER_IP:4000
DATABASE_URL="postgresql://app:!ChangeMe!@db:5432/app?serverVersion=16&charset=utf8"


–ì–¥–µ SERVER_IP ‚Äî –≤–Ω–µ—à–Ω–∏–π IP VPS.
—É –º–µ–Ω—è –∫ –ø—Ä–∏–º–µ—Ä—É –±—ã–ª —ç—Ç–æ—Ç: 37.140.243.106
#### 8. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å compose.yaml
* –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ.
*  –í —Ä–∞–∑–¥–µ–ª–µ php: –≤ compose.yaml –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:

* environment:
* AUDIO_SERVER_URL: "http://SERVER_IP:4000"
* –£ –º–µ–Ω—è –±—ã–ª–æ:
* –∞ –∏—Å–ø—Ä–∞–≤–∏–ª –Ω–∞ AUDIO_SERVER_URL: "http://37.140.243.106:4000"
* –≠—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã –ø–ª–µ–µ—Ä —Ä–∞–±–æ—Ç–∞–ª.

#### 9. –°–≤–æ–±–æ–¥–Ω—ã–π –ø–æ—Ä—Ç 5432 (PostgreSQL)
* –ï—Å–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω PostgreSQL –≤ —Å–∏—Å—Ç–µ–º–µ, –Ω—É–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å:

* systemctl stop postgresql
* systemctl disable postgresql
* –ò–º–µ–Ω–Ω–æ –∏–∑-–∑–∞ —ç—Ç–æ–≥–æ –±—ã–ª–∞ –æ—à–∏–±–∫–∞:
* address already in use 5432.
#### 10. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞
* docker compose up -d --build
* –ü—Ä–æ–≤–µ—Ä–∫–∞: 
* docker compose ps
#### 11. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
* –ú—É–∑—ã–∫–∞:
* curl -I http://YOUR_IP:4000/audio?seed=1&index=5
* –î–µ—Ç–∞–ª—å–Ω–∞—è –ø–µ—Å–Ω—è:
* curl http://YOUR_IP:8080/api/songs/details/5
#### 12. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∞–π—Ç–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
* –û—Ç–∫—Ä—ã—Ç—å:
* http://YOUR_IP:8080

#### 13. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
* –ï—Å–ª–∏ —Å–¥–µ–ª–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ —Ö–æ—á–µ—à—å –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
* docker compose down
* docker compose up -d --build
#### –ò–¢–û–ì-–æ–±–∑–æ—Ä
 * ‚úî VPS —Å Docker –∏ Docker Compose
 * ‚úî –°–∫–∞—á–∞–Ω –ø—Ä–æ–µ–∫—Ç –≤ /var/www/task5-music-store
 * ‚úî –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
 * ‚úî –í .env –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π AUDIO_SERVER_URL
 * ‚úî –í compose.yaml –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π AUDIO_SERVER_URL
 * ‚úî –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å–∏—Å—Ç–µ–º–Ω—ã–π PostgreSQL (–µ—Å–ª–∏ –ø–æ—Ä—Ç 5432 –∑–∞–Ω—è—Ç)
 * ‚úî –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞: docker compose up -d --build
 * ‚úî –û—Ç–∫—Ä—ã—Ç—ã –ø–æ—Ä—Ç—ã 8080 –∏ 4000
 * ‚úî API –æ—Ç–≤–µ—á–∞–µ—Ç
 * ‚úî –ü–ª–µ–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç